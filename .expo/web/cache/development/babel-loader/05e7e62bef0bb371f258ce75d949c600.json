{"ast":null,"code":"var _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.installWebGeolocationPolyfill = installWebGeolocationPolyfill;\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _core = require(\"@unimodules/core\");\n\nvar _ExpoLocation = _interopRequireDefault(require(\"./ExpoLocation\"));\n\nvar _Location = require(\"./Location.types\");\n\nvar _LocationSubscribers = require(\"./LocationSubscribers\");\n\nfunction installWebGeolocationPolyfill() {\n  if (_core.Platform.OS !== 'web') {\n    window.navigator.geolocation = {\n      getCurrentPosition: getCurrentPosition,\n      watchPosition: watchPosition,\n      clearWatch: clearWatch,\n      stopObserving: function stopObserving() {}\n    };\n  }\n}\n\nfunction convertGeolocationOptions(options) {\n  return {\n    accuracy: options.enableHighAccuracy ? _Location.LocationAccuracy.High : _Location.LocationAccuracy.Balanced\n  };\n}\n\nfunction getCurrentPosition(success) {\n  var error = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : function () {};\n  var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n\n  _getCurrentPositionAsyncWrapper(success, error, options);\n}\n\nfunction _getCurrentPositionAsyncWrapper(success, error, options) {\n  var result;\n  return _regenerator.default.async(function _getCurrentPositionAsyncWrapper$(_context) {\n    while (1) {\n      switch (_context.prev = _context.next) {\n        case 0:\n          _context.prev = 0;\n          _context.next = 3;\n          return _regenerator.default.awrap(_ExpoLocation.default.requestPermissionsAsync());\n\n        case 3:\n          _context.next = 5;\n          return _regenerator.default.awrap(_ExpoLocation.default.getCurrentPositionAsync(convertGeolocationOptions(options)));\n\n        case 5:\n          result = _context.sent;\n          success(result);\n          _context.next = 12;\n          break;\n\n        case 9:\n          _context.prev = 9;\n          _context.t0 = _context[\"catch\"](0);\n          error(_context.t0);\n\n        case 12:\n        case \"end\":\n          return _context.stop();\n      }\n    }\n  }, null, null, [[0, 9]], Promise);\n}\n\nfunction watchPosition(success, error, options) {\n  var watchId = _LocationSubscribers.LocationSubscriber.registerCallback(success);\n\n  _ExpoLocation.default.watchPositionImplAsync(watchId, options).catch(function (err) {\n    _LocationSubscribers.LocationSubscriber.unregisterCallback(watchId);\n\n    error({\n      watchId: watchId,\n      message: err.message,\n      code: err.code\n    });\n  });\n\n  return watchId;\n}\n\nfunction clearWatch(watchId) {\n  _LocationSubscribers.LocationSubscriber.unregisterCallback(watchId);\n}","map":{"version":3,"sources":["../src/GeolocationPolyfill.ts"],"names":[],"mappings":";;;;;;;;;AAAA;;AAEA;;AACA;;AACA;;AASM,SAAU,6BAAV,GAAuC;AAC3C,MAAI,eAAS,EAAT,KAAgB,KAApB,EAA2B;AAIzB,IAAA,MAAM,CAAC,SAAP,CAAiB,WAAjB,GAA+B;AAC7B,MAAA,kBAAkB,EAAlB,kBAD6B;AAE7B,MAAA,aAAa,EAAb,aAF6B;AAG7B,MAAA,UAAU,EAAV,UAH6B;AAO7B,MAAA,aAAa,EAAE,yBAAK,CAAG;AAPM,KAA/B;AASD;AACF;;AAED,SAAS,yBAAT,CAAmC,OAAnC,EAA8D;AAC5D,SAAO;AACL,IAAA,QAAQ,EAAE,OAAO,CAAC,kBAAR,GAA6B,2BAAiB,IAA9C,GAAqD,2BAAiB;AAD3E,GAAP;AAGD;;AAED,SAAS,kBAAT,CACE,OADF,EAGkC;AAAA,MADhC,KACgC,uEADE,YAAK,CAAG,CACV;AAAA,MAAhC,OAAgC,uEAAF,EAAE;;AAEhC,EAAA,+BAA+B,CAAC,OAAD,EAAU,KAAV,EAAiB,OAAjB,CAA/B;AACD;;AAID,SAAe,+BAAf,CACE,OADF,EAEE,KAFF,EAGE,OAHF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,4CAMU,sBAAa,uBAAb,EANV;;AAAA;AAAA;AAAA,4CAOyB,sBAAa,uBAAb,CAAqC,yBAAyB,CAAC,OAAD,CAA9D,CAPzB;;AAAA;AAOU,UAAA,MAPV;AAQI,UAAA,OAAO,CAAC,MAAD,CAAP;AARJ;AAAA;;AAAA;AAAA;AAAA;AAUI,UAAA,KAAK,aAAL;;AAVJ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAeA,SAAS,aAAT,CACE,OADF,EAEE,KAFF,EAGE,OAHF,EAG6B;AAE3B,MAAM,OAAO,GAAG,wCAAmB,gBAAnB,CAAoC,OAApC,CAAhB;;AAEA,wBAAa,sBAAb,CAAoC,OAApC,EAA6C,OAA7C,EAAsD,KAAtD,CAA4D,UAAA,GAAG,EAAG;AAChE,4CAAmB,kBAAnB,CAAsC,OAAtC;;AACA,IAAA,KAAK,CAAC;AAAE,MAAA,OAAO,EAAP,OAAF;AAAW,MAAA,OAAO,EAAE,GAAG,CAAC,OAAxB;AAAiC,MAAA,IAAI,EAAE,GAAG,CAAC;AAA3C,KAAD,CAAL;AACD,GAHD;;AAKA,SAAO,OAAP;AACD;;AAGD,SAAS,UAAT,CAAoB,OAApB,EAAmC;AACjC,0CAAmB,kBAAnB,CAAsC,OAAtC;AACD","sourcesContent":["import { Platform } from '@unimodules/core';\n\nimport ExpoLocation from './ExpoLocation';\nimport { LocationObject, LocationAccuracy, LocationOptions } from './Location.types';\nimport { LocationSubscriber } from './LocationSubscribers';\n\ntype GeolocationSuccessCallback = (data: LocationObject) => void;\ntype GeolocationErrorCallback = (error: any) => void;\n\ntype GeolocationOptions = {\n  enableHighAccuracy?: boolean;\n};\n\nexport function installWebGeolocationPolyfill(): void {\n  if (Platform.OS !== 'web') {\n    // Polyfill navigator.geolocation for interop with the core react-native and web API approach to\n    // geolocation\n    // @ts-ignore\n    window.navigator.geolocation = {\n      getCurrentPosition,\n      watchPosition,\n      clearWatch,\n\n      // We don't polyfill stopObserving, this is an internal method that probably should not even exist\n      // in react-native docs\n      stopObserving: () => {},\n    };\n  }\n}\n\nfunction convertGeolocationOptions(options: GeolocationOptions): LocationOptions {\n  return {\n    accuracy: options.enableHighAccuracy ? LocationAccuracy.High : LocationAccuracy.Balanced,\n  };\n}\n\nfunction getCurrentPosition(\n  success: GeolocationSuccessCallback,\n  error: GeolocationErrorCallback = () => {},\n  options: GeolocationOptions = {}\n): void {\n  _getCurrentPositionAsyncWrapper(success, error, options);\n}\n\n// This function exists to let us continue to return undefined from getCurrentPosition, while still\n// using async/await for the internal implementation of it\nasync function _getCurrentPositionAsyncWrapper(\n  success: GeolocationSuccessCallback,\n  error: GeolocationErrorCallback,\n  options: GeolocationOptions\n): Promise<any> {\n  try {\n    await ExpoLocation.requestPermissionsAsync();\n    const result = await ExpoLocation.getCurrentPositionAsync(convertGeolocationOptions(options));\n    success(result);\n  } catch (e) {\n    error(e);\n  }\n}\n\n// Polyfill: navigator.geolocation.watchPosition\nfunction watchPosition(\n  success: GeolocationSuccessCallback,\n  error: GeolocationErrorCallback,\n  options: GeolocationOptions\n) {\n  const watchId = LocationSubscriber.registerCallback(success);\n\n  ExpoLocation.watchPositionImplAsync(watchId, options).catch(err => {\n    LocationSubscriber.unregisterCallback(watchId);\n    error({ watchId, message: err.message, code: err.code });\n  });\n\n  return watchId;\n}\n\n// Polyfill: navigator.geolocation.clearWatch\nfunction clearWatch(watchId: number) {\n  LocationSubscriber.unregisterCallback(watchId);\n}\n"],"sourceRoot":""},"metadata":{},"sourceType":"script"}